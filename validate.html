<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validador de Mejoras - Portfolio Alex Henr√≠quez</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #e1f5fe 100%);
            padding: 2rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
        }

        h1 {
            background: linear-gradient(135deg, #2af598 0%, #009efd 50%, #2af598 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            font-size: 2rem;
        }

        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f0f9ff;
            border-radius: 12px;
            border-left: 4px solid #0ea5e9;
        }

        .section h2 {
            color: #0f172a;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .check-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .status.success {
            background: #10B981;
            color: white;
        }

        .status.error {
            background: #EF4444;
            color: white;
        }

        .status.warning {
            background: #F59E0B;
            color: white;
        }

        .status.pending {
            background: #6B7280;
            color: white;
        }

        .message {
            flex: 1;
            font-size: 0.95rem;
            color: #475569;
        }

        .summary {
            background: linear-gradient(135deg, #2af598 0%, #009efd 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .summary h2 {
            color: white;
            margin-bottom: 0.5rem;
        }

        .stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        button {
            background: linear-gradient(135deg, #2af598 0%, #009efd 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 1rem;
            transition: transform 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        .actions {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }

        .link {
            color: #0ea5e9;
            text-decoration: none;
            font-weight: 500;
        }

        .link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Validador de Mejoras - Portfolio</h1>

        <div class="summary">
            <h2>Resumen de Validaci√≥n</h2>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="successCount">0</div>
                    <div class="stat-label">Exitosos</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="errorCount">0</div>
                    <div class="stat-label">Errores</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="warningCount">0</div>
                    <div class="stat-label">Advertencias</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="pendingCount">0</div>
                    <div class="stat-label">Pendientes</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìÑ Archivos Cr√≠ticos</h2>
            <div id="files"></div>
        </div>

        <div class="section">
            <h2>üîß Service Worker</h2>
            <div id="serviceWorker"></div>
        </div>

        <div class="section">
            <h2>üíæ Cach√©</h2>
            <div id="cache"></div>
        </div>

        <div class="section">
            <h2>üì± PWA Manifest</h2>
            <div id="manifest"></div>
        </div>

        <div class="section">
            <h2>üé® Favicon</h2>
            <div id="favicon"></div>
        </div>

        <div class="actions">
            <button onclick="runValidation()">üîÑ Volver a Validar</button>
            <button onclick="window.open('/', '_blank')">üè† Ir al Portfolio</button>
            <button onclick="window.open('SETUP.md', '_blank')">üìñ Ver Setup</button>
        </div>
    </div>

    <script>
        let stats = { success: 0, error: 0, warning: 0, pending: 0 };

        function addCheck(container, message, status) {
            const item = document.createElement('div');
            item.className = 'check-item';

            const statusIcon = document.createElement('div');
            statusIcon.className = `status ${status}`;
            statusIcon.textContent = status === 'success' ? '‚úì' :
                                    status === 'error' ? '‚úó' :
                                    status === 'warning' ? '!' : '‚ãØ';

            const msg = document.createElement('div');
            msg.className = 'message';
            msg.innerHTML = message;

            item.appendChild(statusIcon);
            item.appendChild(msg);
            container.appendChild(item);

            stats[status]++;
        }

        function updateStats() {
            document.getElementById('successCount').textContent = stats.success;
            document.getElementById('errorCount').textContent = stats.error;
            document.getElementById('warningCount').textContent = stats.warning;
            document.getElementById('pendingCount').textContent = stats.pending;
        }

        async function checkFile(url) {
            try {
                const response = await fetch(url);
                return response.ok;
            } catch {
                return false;
            }
        }

        async function validateFiles() {
            const filesContainer = document.getElementById('files');
            filesContainer.innerHTML = '';

            const files = [
                { name: 'sitemap.xml', url: '/sitemap.xml' },
                { name: 'robots.txt', url: '/robots.txt' },
                { name: 'sw.js', url: '/sw.js' },
                { name: 'manifest.json', url: '/manifest.json' },
                { name: 'favicon.svg', url: '/favicon.svg' }
            ];

            for (const file of files) {
                const exists = await checkFile(file.url);
                addCheck(
                    filesContainer,
                    `${file.name} ${exists ? 'encontrado' : 'no encontrado'}`,
                    exists ? 'success' : 'error'
                );
            }

            // Favicons PNG
            const pngFiles = [
                'favicon-16x16.png',
                'favicon-32x32.png',
                'apple-touch-icon.png',
                'favicon-192x192.png',
                'favicon-512x512.png'
            ];

            let pngCount = 0;
            for (const png of pngFiles) {
                if (await checkFile(`/${png}`)) pngCount++;
            }

            if (pngCount === 5) {
                addCheck(filesContainer, 'Todos los favicons PNG generados', 'success');
            } else if (pngCount > 0) {
                addCheck(filesContainer, `S√≥lo ${pngCount}/5 favicons PNG generados`, 'warning');
            } else {
                addCheck(filesContainer, 'Favicons PNG no generados - Usar generate-favicons.html', 'pending');
            }

            // OG Image
            const ogExists = await checkFile('/og-image.png');
            addCheck(
                filesContainer,
                ogExists ? 'Imagen Open Graph (og-image.png) encontrada' : 'Imagen Open Graph pendiente (recomendado)',
                ogExists ? 'success' : 'warning'
            );
        }

        async function validateServiceWorker() {
            const swContainer = document.getElementById('serviceWorker');
            swContainer.innerHTML = '';

            if ('serviceWorker' in navigator) {
                addCheck(swContainer, 'API Service Worker soportada', 'success');

                try {
                    const registration = await navigator.serviceWorker.getRegistration();

                    if (registration) {
                        addCheck(swContainer, 'Service Worker registrado', 'success');

                        if (registration.active) {
                            addCheck(swContainer, 'Service Worker activo', 'success');
                        } else if (registration.installing) {
                            addCheck(swContainer, 'Service Worker instal√°ndose...', 'warning');
                        } else {
                            addCheck(swContainer, 'Service Worker registrado pero no activo', 'warning');
                        }
                    } else {
                        addCheck(swContainer, 'Service Worker no registrado - Recargar p√°gina', 'warning');
                    }
                } catch (error) {
                    addCheck(swContainer, `Error al verificar SW: ${error.message}`, 'error');
                }
            } else {
                addCheck(swContainer, 'Service Workers no soportados en este navegador', 'error');
            }
        }

        async function validateCache() {
            const cacheContainer = document.getElementById('cache');
            cacheContainer.innerHTML = '';

            if ('caches' in window) {
                addCheck(cacheContainer, 'API Cache Storage soportada', 'success');

                try {
                    const cacheNames = await caches.keys();

                    if (cacheNames.length > 0) {
                        addCheck(cacheContainer, `${cacheNames.length} cach√©(s) encontrado(s)`, 'success');

                        for (const cacheName of cacheNames) {
                            const cache = await caches.open(cacheName);
                            const keys = await cache.keys();
                            addCheck(
                                cacheContainer,
                                `Cach√© "${cacheName}": ${keys.length} recursos`,
                                'success'
                            );
                        }
                    } else {
                        addCheck(cacheContainer, 'Sin cach√©s - Visitar el sitio primero', 'warning');
                    }
                } catch (error) {
                    addCheck(cacheContainer, `Error al verificar cach√©: ${error.message}`, 'error');
                }
            } else {
                addCheck(cacheContainer, 'Cache Storage no soportado', 'error');
            }
        }

        async function validateManifest() {
            const manifestContainer = document.getElementById('manifest');
            manifestContainer.innerHTML = '';

            try {
                const response = await fetch('/manifest.json');
                if (response.ok) {
                    const manifest = await response.json();

                    addCheck(manifestContainer, 'Manifest.json cargado correctamente', 'success');
                    addCheck(manifestContainer, `Nombre: "${manifest.name}"`, 'success');
                    addCheck(manifestContainer, `Nombre corto: "${manifest.short_name}"`, 'success');
                    addCheck(manifestContainer, `${manifest.icons.length} √≠cono(s) definido(s)`, 'success');
                    addCheck(manifestContainer, `Theme color: ${manifest.theme_color}`, 'success');

                    if (manifest.display === 'standalone') {
                        addCheck(manifestContainer, 'Display mode: standalone (PWA completo)', 'success');
                    }
                } else {
                    addCheck(manifestContainer, 'Error al cargar manifest.json', 'error');
                }
            } catch (error) {
                addCheck(manifestContainer, `Error: ${error.message}`, 'error');
            }
        }

        async function validateFavicon() {
            const faviconContainer = document.getElementById('favicon');
            faviconContainer.innerHTML = '';

            // Check SVG
            const svgExists = await checkFile('/favicon.svg');
            addCheck(
                faviconContainer,
                svgExists ? 'Favicon SVG encontrado' : 'Favicon SVG no encontrado',
                svgExists ? 'success' : 'error'
            );

            // Check link tags in head
            const faviconLinks = document.querySelectorAll('link[rel*="icon"]');
            addCheck(
                faviconContainer,
                `${faviconLinks.length} link tag(s) de favicon en el HTML`,
                faviconLinks.length > 0 ? 'success' : 'warning'
            );

            // Check Apple Touch Icon
            const appleTouchIcon = document.querySelector('link[rel="apple-touch-icon"]');
            addCheck(
                faviconContainer,
                appleTouchIcon ? 'Apple Touch Icon configurado' : 'Apple Touch Icon no configurado',
                appleTouchIcon ? 'success' : 'warning'
            );
        }

        async function runValidation() {
            // Reset stats
            stats = { success: 0, error: 0, warning: 0, pending: 0 };

            await validateFiles();
            await validateServiceWorker();
            await validateCache();
            await validateManifest();
            await validateFavicon();

            updateStats();

            // Conclusion
            const total = stats.success + stats.error + stats.warning + stats.pending;
            const percentage = Math.round((stats.success / total) * 100);

            console.log(`‚úÖ Validaci√≥n completada: ${percentage}% exitoso`);
            console.log(`‚úì ${stats.success} | ‚úó ${stats.error} | ! ${stats.warning} | ‚ãØ ${stats.pending}`);
        }

        // Run validation on load
        window.addEventListener('load', runValidation);
    </script>
</body>
</html>
